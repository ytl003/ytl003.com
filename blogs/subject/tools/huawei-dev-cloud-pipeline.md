---
title: 华为devCloud——流水线
date: 2020-12-16
description: 华为devCloud——流水线
sidebar: false
categories:
 - tools
tags:
 - 工具
 - 流水线
 - 部署
 - vuepress
---

[华为devcloud](https://devcloud.huaweicloud.com/)(https://devcloud.huaweicloud.com/)是一个专门为软件公司定制的贯穿一整套软件开发流程的工作服务平台。软件的设计，任务分配，研发，代码检测，测试，构建，部署，发布都可以在一个平台上完成。

因为“独慕日记”网站就使用了华为devCloud中的自动构建和部署功能，那么我们今天就来讲讲“独慕日记”网站是怎样部署互联网上的。

之前，先说说“独慕日记”都使用了那些技术和平台

1. 服务器：腾讯云
2. 代码托管平台：码云
3. 图床：七牛云对象存储
4. 构建流水线：华为devcloud

其实，上面这些除了构建流水线其他几项几大云服务提供商都有对应的服务。但是其实流水线这个也有替代方案，比如现在很火的`jenkins`。

华为云以上功能都有那为什么不都使用华为云呐，那当然就是因为穷啦🌚🌚🌚  以上除了腾讯云服务器其他都是免费滴 🙈🙈

## 配置步骤：

1. 配置构建编译

   ![image-20201219171633021](http://qcdn.ytl003.com/md/image-20201219171633021.png)

   - 新增一个’编译构建’任务

   - 选择源码仓库

     选择原来来自流水线（来自流水线就可以配置自动触发执行）

     ![image-20201219171919399](http://qcdn.ytl003.com/md/image-20201219171919399.png)

   - 配置构建步骤

     “独慕日记”是一个比较简单的vuepress程序，所以编译比较简单。

     其中包含两部：1、yarn构建（当然npm构建也是可以的）2、把编译后的代码包上传到发布库

     > 构建的时候需要注意build的路径，构建包的路径和名字需要跟第二步中配置的构建包路径配置一致，如果shell执行报错系统会判断为该步骤执行失败，后面的流水线将不执行

   ![image-20201219172059279](http://qcdn.ytl003.com/md/image-20201219172059279.png)![image-20201219172441217](http://qcdn.ytl003.com/md/image-20201219172441217.png)

   编译后的代码会保存在这里

   ![image-20201219174349691](http://qcdn.ytl003.com/md/image-20201219174349691.png)

2. 添加主机

   添加linux或者windows主机

   ![image-20201219175421063](http://qcdn.ytl003.com/md/image-20201219175421063.png)

   我这里使用的是腾讯云的云主机，直接填入IP地址和账号密码。你也可以选择密钥登录，当然为了安全起见你也可以创建一个专门用于部署的账户

   ![image-20201219175501536](http://qcdn.ytl003.com/md/image-20201219175501536.png)

3. 编写发布脚本

   发布配置有些类似于构建配置，首先第一步就是先将编译好的静态网站文件资源包下载到云主机上。源类型可以选择构建任务，构建序列好可以选择’latest’就可以保证下载的是最新编译的资源包

   ![](http://qcdn.ytl003.com/md/image-20201219175713896-20201219180130969.png)

   ![image-20201219175751936](http://qcdn.ytl003.com/md/image-20201219175751936.png)

   第二步配置解压资源包就比较简单了，删除原来的资源文件，解压新的资源文件就可以了

   ![image-20201219180116635](http://qcdn.ytl003.com/md/image-20201219180116635.png)

4. 云主机上配置nginx

   至于安装nginx大家可以百度一下啦，或者可以直接安装[宝塔](http://www.bt.cn/) 这样集成的有管理界面的服务器管理面板

   ``` nginx
   server
   {
       listen 80;
       server_name {your domain};
       index index.html;
       root {absolute path};
   }
   ```

   现在访问你的域名应该就可以看到你的网站啦！

5. 配置流水线

   这一步就比较简单了，就是把代码仓库和之前配置编译，部署配置在一起，就像工厂流水线一样一步一步执行

   ![image-20201219190209439](http://qcdn.ytl003.com/md/image-20201219190209439.png)

   配置代码仓库。推荐使用码云的代码仓库，首先是国内访问比较快，其次主要是因为他支持触发事件。其他的目前自动触发的话只能设置定时。

   ![image-20201219190242893](http://qcdn.ytl003.com/md/image-20201219190242893.png)

   接下来就是点击添加任务，把之前配置的构建和部署添加进来就可以

   > 要注意的是每一列任务列表是可以并行和串行的，如果两个任务放在同一列的话需要将该列构建设置为串行，默认是并行的，就会导致部署的是上一次最后构建的资源包。

   ![image-20201219190737961](http://qcdn.ytl003.com/md/image-20201219190737961.png)

   这个时候push代码就可以看到流水线自动进行了，并且执行完成后会将执行结果推送给你（当然你完全可以设置为执行失败才推送，或者直接关闭推送）

   ![image-20201219191052225](http://qcdn.ytl003.com/md/image-20201219191052225.png)

